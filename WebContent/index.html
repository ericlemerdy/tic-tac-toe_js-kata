<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<script src="offline/jquery-latest.js"></script>
<link rel="stylesheet" href="offline/qunit.css" type="text/css"
	media="screen" />
<script type="text/javascript" src="offline/qunit.js"></script>

<script>
	Game = function() {
		this.fields = Array(false, false, false, false, false, false, false, false, false);
		this._currentPlayer = "X";
	}
	Game.prototype = {
		take: function(field) {
			if (this.fields[field-1]) {
				return this._currentPlayer;
			}
			this.fields[field-1] = true;
			this._currentPlayer = (this._currentPlayer == "X" ? "O" : "X");
			return this._currentPlayer;
		},
		isFinished: function() {
			var all = this.fields.every(function (field){
				return field;
			});
			
			var line = this._checkCombinations([[0, 1, 2], [3, 4, 5], [6, 7, 8]]);
			var colonne = this._checkCombinations([[0, 3, 6], [1, 4, 7], [2, 5, 8]]);
			var diagonale = this._checkCombinations([[0, 4, 8], [2, 4, 6]]);
			
			return all || line || colonne || diagonale;
		},
		currentPlayer: function() {
			return this._currentPlayer;
		},
		_checkCombination: function (i1, i2, i3) {
			return this.fields[i1] && this.fields[i2] && this.fields[i3];
		},
		_checkCombinations: function (combinations) {
			for (var i = 0; i < combinations.length; i++) {
				if(this._checkCombination.apply(this, combinations[i])) {
					return true;
				}
			}
			
			return false;
		},
		winner: function () {
			return "X";
		}
	}

	$(document)
			.ready(
					function() {
						module("6. Les joueurs jouent alternativement jusqu'à ce que le jeu termine ou qu'un joueur gagne.");
						test(
								"Les joueurs jouent alternativement.",
								function() {
									game = new Game();
									equals(game.take(1), "O");
									equals(game.currentPlayer(), "O", "Le joueur a du changer normalement.");
									equals(game.take(2), "X");
									equals(game.currentPlayer(), "X", "Le joueur a du re-changer normalement.");
								}
						);
						test(
								"Le jeu peut être gagné.",
								function() {
									game = new Game();
									equals(game.take(1), "O");
									equals(game.take(2), "X");
									equals(game.take(5), "O");
									equals(game.take(3), "X");
									equals(game.take(9), "O");
									equals(game.winner(), "X", "Le gagnant est X.");
								}
						);
						module("5. Case non vide");
						test(
								"",
								function() {
									"Une case non vide ne peut pas être prise."
									game = new Game();
									ok(game.take(1));
									ok(!game.take(1));
								});
						module("4. Diagonales");
						test(
								"Le jeu est fini lorsque je prends une diagonale",
								function() {
									game = new Game();
									game.take(1);
									game.take(5);
									game.take(9);
									ok(game.isFinished(),
									"quand je prends la premiere diagonale, le jeu est fini.");
									
									game = new Game();
									game.take(3);
									game.take(5);
									game.take(7);
									ok(game.isFinished(),
									"quand je prends la deuxieme diagonale, le jeu est fini.");
								});
						module("3. Colonne");
						test(
								"Le jeu est fini lorsqu'une colonne est prise",
								function() {
									game = new Game();
									game.take(1);
									game.take(4);
									game.take(7);
									ok(game.isFinished(),
									"quand je prends la premiere colonne, le jeu est fini.");
									
									game = new Game();
									game.take(2);
									game.take(5);
									game.take(8);
									ok(game.isFinished(),
									"quand je prends la deuxieme colonne, le jeu est fini.");
									
									game = new Game();
									game.take(3);
									game.take(6);
									game.take(9);
									ok(game.isFinished(),
									"quand je prends la 3eme colonne, le jeu est fini.");
								});
						module("2. Ligne");
						test(
								"Le jeu n'est pas fini si 3 cases non alignées sont prises",
								function() {
									game = new Game();
									game.take(1);
									game.take(5);
									game.take(3);
									ok(!game.isFinished(),
									"quand je prends 3 cases non alignées, le jeu n'est pas fini.");
								});
						test(
								"Le jeu fait jouer un joueur.",
								function() {
									game = new Game();
									equals(game.currentPlayer(), "X", "Le joueur qui commence est X.");
								});
						test(
								"Le jeu est fini quand toutes les cases d'une même ligne sont prises",
								function() {
									game = new Game();
									game.take(1);
									game.take(2);
									game.take(3);
									ok(game.isFinished(),
									"quand je prends la première ligne, le jeu est fini.");
									
									game = new Game();
									game.take(4);
									game.take(5);
									game.take(6);
									ok(game.isFinished(),
									"quand je prends la deuxième ligne, le jeu est fini.");
									
									game = new Game();
									game.take(7);
									game.take(8);
									game.take(9);
									ok(game.isFinished(),
									"quand je prends la troisième ligne, le jeu est fini.");
								});
						module("1. Fin");
						test(
								"Le jeu est terminé si toutes les cases sont prises",
								function() {
									game = new Game();
									game.take(1);
									game.take(2);
									game.take(3);
									game.take(4);
									game.take(5);
									game.take(6);
									game.take(7);
									game.take(8);
									game.take(9);
									ok(game.isFinished(),
											"quand je prends toutes les cases, ça doit être fini.");
								});
						test(
								"Le jeu n'est pas terminé si aucune case n'est prise",
								function() {
									game = new Game();
									ok(!game.isFinished(),
											"quand je prends aucune case, ça doit pas être fini.");
								});
						test(
								"Le jeu n'est pas terminé si 1 case est prise",
								function() {
									game = new Game();
									game.take(3);
									ok(!game.isFinished(),
											"quand je prends une case, ça doit pas être fini.");
								});

					});
</script>

</head>
<body>
	<h1 id="qunit-header">QUnit example</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup, will be hidden</div>
</body>
</html>